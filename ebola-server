#!/usr/bin/env python3
"""Start the ebola server

Usage:
ebola-server [--root=ROOT] start
ebola-server [--root=ROOT] stop
ebola-server [--root=ROOT] update-passwords
"""


import os
import os.path
import sys

import docopt


def set_root(root):
    root = os.path.abspath(root or os.path.dirname(sys.argv[0]))
    src = root + "/src"
    print("root = {}, src = {}".format(root, src))
    os.chdir(src)
    sys.path.insert(1, src)


def start(root):
    set_root(root)
    import deploy
    deploy.start()


def stop(root):
    set_root(root)
    import deploy
    deploy.stop()


def update_passwords(root)
    set_root(root)
    import deploy
    import service
    s = service.Service({})
    deploy.configure_proxy_users(s)


if __name__ == "__main__":
    args = docopt.docopt(__doc__)
    root = args["--root"]
    if args['start']:
        start(root)
    elif args['stop']:
        stop(root)
    elif args['update-passwords']:
        update_passwords(root)
